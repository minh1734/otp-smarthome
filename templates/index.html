<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ƒêi·ªÅu khi·ªÉn thi·∫øt b·ªã th√¥ng minh</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #ffffff;
            color: #333;
            padding: 40px;
        }

        h1 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 32px;
        }

        /* ======= FLEX LAYOUT ======= */
        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            max-width: 1100px;
            margin: auto;
        }

        /* ======= CARD CHUNG ======= */
        .card {
            width: 300px;
            padding: 25px;
            border-radius: 18px;
            background: #fff;
            border: 1px solid #e5e5e5;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            transition: 0.25s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 5px 18px rgba(0,0,0,0.15);
        }

        /* ======= L·ªäCH S·ª¨ ======= */
        .history-box {
            width: 370px;
            padding: 20px;
            border-radius: 18px;
            background: #fff;
            border: 1px solid #e5e5e5;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            transition: 0.3s;
        }

        #history {
            list-style: none;
            padding-left: 0;
            max-height: 350px;
            overflow-y: auto;
        }

        #history li {
            padding: 10px 12px;
            margin-bottom: 10px;
            background: #f5f5f5;
            border-radius: 10px;
            transition: 0.25s;
        }

        #history li:hover {
            background: #e9e9e9;
            transform: translateX(5px);
        }

        /*======== BUTTON ========*/
        button {
            width: 120px;
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            transition: 0.25s;
            font-weight: bold;
            color: white;
        }

        .on {
            background: #4CAF50;
        }

        .off {
            background: #F44336;
        }

        button:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        /* ======= N√öT M·ªû / ƒê√ìNG L·ªäCH S·ª¨ ======= */
        .toggle-btn {
            margin-bottom: 12px;
            background: #3f51b5;
        }
    </style>
</head>

<body>

<h1>üîå ƒêi·ªÅu khi·ªÉn thi·∫øt b·ªã th√¥ng minh</h1>

<div class="container">

    <!-- C·ªòT TR√ÅI: ƒê√àN + ƒêI·ªÄU H√íA -->
    <div>
        <div class="card">
            <h2>üí° ƒê√®n</h2>
            <p id="status-light">Tr·∫°ng th√°i: ...</p>
            <button class="on" onclick="setLight('on')">B·∫≠t</button>
            <button class="off" onclick="setLight('off')">T·∫Øt</button>
        </div>

        <div class="card" style="margin-top:25px;">
            <h2>‚ùÑÔ∏è ƒêi·ªÅu h√≤a</h2>
            <p id="status-ac">Tr·∫°ng th√°i: ...</p>
            <button class="on" onclick="setAC('on')">B·∫≠t</button>
            <button class="off" onclick="setAC('off')">T·∫Øt</button>
        </div>
    </div>

    <!-- C·ªòT PH·∫¢I: L·ªäCH S·ª¨ -->
    <div class="history-box">
        <button class="toggle-btn" onclick="toggleHistory()">üìú Hi·ªán / ·∫®n L·ªãch s·ª≠</button>

        <h2>üìò L·ªãch s·ª≠ thi·∫øt b·ªã</h2>

        <ul id="history">
            <li>ƒêang t·∫£i...</li>
        </ul>
    </div>

</div>

<script>
    const API = "http://localhost:5000";

    /* ===== TR·∫†NG TH√ÅI ƒê√àN ===== */
    function loadLight() {
        fetch(`${API}/device/light`)
            .then(res => res.json())
            .then(data => {
                document.getElementById("status-light").innerText =
                    "Tr·∫°ng th√°i: " + (data.status === "on" ? "B·∫≠t" : "T·∫Øt");
            });
    }

    function setLight(state) {
        fetch(`${API}/device/light`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ status: state })
        })
        .then(() => { loadLight(); loadHistory(); });
    }

    /* ===== TR·∫†NG TH√ÅI ƒêI·ªÄU H√íA ===== */
    function loadAC() {
        fetch(`${API}/device/ac`)
            .then(res => res.json())
            .then(data => {
                document.getElementById("status-ac").innerText =
                    "Tr·∫°ng th√°i: " + (data.status === "on" ? "B·∫≠t" : "T·∫Øt");
            });
    }

    function setAC(state) {
        fetch(`${API}/device/ac`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ status: state })
        })
        .then(() => { loadAC(); loadHistory(); });
    }

    /* ===== L·ªäCH S·ª¨ ===== */
    function loadHistory() {
        fetch(`${API}/history`)
            .then(res => res.json())
            .then(data => {
                const list = document.getElementById("history");
                list.innerHTML = "";

                data.forEach(item => {
                    let li = document.createElement("li");
                    const time = item.time ? item.time : '';
                    li.innerText = time ? `${time} ‚Üí ${item.history}` : item.history;
                    list.appendChild(li);
                });
            });
    }

    /* ===== N√öT ƒê√ìNG / M·ªû L·ªäCH S·ª¨ ===== */
    function toggleHistory() {
        const box = document.getElementById("history");
        box.style.display = (box.style.display === "none") ? "block" : "none";
    }

    loadLight();
    loadAC();
    loadHistory();
</script>

</body>
</html>
